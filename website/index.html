<!--
 *  Index HTML
 *
 *  The RDF Transform Main Index HTML page.
 *
 *  Copyright 2025 Keven L. Ates
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
-->
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN" "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd" />
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title id="head_title"></title>
    <base id="base_iri" href="" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link rel="stylesheet" type="text/css" href="rdf-transform.css" />
    <link rel="shortcut icon" type="image/x-icon" id="favicon" href="images/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32.png" />
  </head>
  <body>
    <div id="header">
      <div id="header-title"></div>
      <ul id="main-nav"></ul>
    </div>
    <div id="title-stripe">
      <div id="title"></div>
    </div>
    <div id="content"></div>
    <div id="footer">
      <div id="footer-text">
        <ul id="footer-links">
          <li><a href="#about">About</a></li>
          <li class="last"><a href="#gpl">GPL</a></li>
        </ul>
        <div id="tagline">
          <img src="images/favicon-32.png" alt="Motorcycle" style="vertical-align: middle;" />
          <span style="vertical-align: middle;"> Transform your life with another quality Linked Data project.</span>
        </div>
      </div>
    </div>

    <script type="text/javascript">

        function load_content(strFile, elemForHTML, strAbsBase) {
            if (strFile) {
                // Make an HTTP request using the file name...
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange =
                    () => {
                        if (xhr.readyState == XMLHttpRequest.DONE) {
                            const iStatus = xhr.status;
                            if (iStatus === 0 || iStatus === 200) {
                                elemForHTML.innerHTML = xhr.responseText;
                                getLinks( elemForHTML.getElementsByTagName('a') );
                            }
                        }
                    };
                xhr.open("GET", strAbsBase + 'content/' + strFile + '.html', true);
                xhr.send();
                /* Exit the function: */
                return;
            }
        };

        function getLinks(links) {
            for (i = 0; i < links.length; i++) {
                links[i].addEventListener('click', linkClick);
            }
        }

        function linkClick(evt) {
            window.location.href = evt.target.href;
            window.location.reload();
        }

        // Control reload on history change...
        window.onpopstate = function(event)
        {
            window.location.reload();
        };

        function theLoader() {
            // ==========================================
            //
            //  SITE STRUCTURE AND PAGES
            //
            // ==========================================

            const listMainLinks = {
                'Home' : '',
                'Showcases' : 'showcases',
                'Docs' : 'docs',
                'Support' : 'support-dev',
                'Download' : 'download'
            };

            const listSectionLinks = {
                'docs' : {
                    'Overview' : 'docs',
                    'Review' : 'reviewDoc',
                    'Transform' : 'transformJSON',
                    'Installation' : 'installationDoc',
                    'Publications' : 'publications',
                    'FAQ' : 'faq'
                },
                'support-dev' : {
                    'Overview' : 'support-dev',
                    'Download Latest' : 'download-latest',
                    'Issue Tracker' : 'issues',
                    'Source Code' : 'source'
                },
                'showcases' : {
                    'Overview' : 'showcases',
                    'Flavors of Cacao' : 'foc-example'
                },
                'download' : {
                    'Overview' : 'download',
                    'Latest Release' : 'download-latest',
                    'Other Releases' : 'releases'
                }
            };

            const listPages = {
                '' : {
                    'head_title' : 'Home',
                    'title_content' : 'home-intro',
                    'content' : 'home-text',
                },
                'docs' : {
                    'head_title' : 'Docs',
                    'title' : 'Documentation',
                    'text' : 'docs',
                },
                'support-dev' : {
                    'head_title' : 'Support',
                    'title' : 'Support and Development',
                    'text' : 'support-dev',
                    'sidebar' : 'team',
                },
                'showcases' : {
                    'head_title' : 'Showcase',
                    'title' : 'Showcases',
                    'text' : 'showcases',
                },
                'download' : {
                    'head_title' : 'Download',
                    'title' : 'Download',
                    'text' : 'download',
                },
                'installationDoc' : {
                    'head_title' : 'Install',
                    'title' : 'Installation Guide',
                    'section' : 'docs',
                    'text' : 'installation',
                },
                'reviewDoc' : {
                    'head_title' : 'Review',
                    'title' : 'Review',
                    'section' : 'docs',
                    'text' : 'review',
                },
                'transformJSON' : {
                    'head_title' : 'Transform',
                    'title' : 'RDF Transform Template',
                    'section' : 'docs',
                    'text' : 'template',
                },
                'faq' : {
                    'head_title' : 'FAQ',
                    'title' : 'Frequently Asked Questions',
                    'section' : 'docs',
                    'text' : 'faq',
                },
                'publications' : {
                    'head_title' : 'Publications',
                    'title' : 'Related Publications',
                    'section' : 'docs',
                    'text' : 'publications',
                },
                'foc-example' : {
                    'head_title' : 'FoC Example',
                    'title' : 'Example Transform: Flavors of Cacao',
                    'section' : 'showcases',
                    'text' : 'foc-example',
                },
                'about' : {
                    'head_title' : 'About',
                    'title' : 'About',
                    'text' : 'about',
                },
                'gpl' : {
                    'title' : 'GNU Public License',
                    'redirect' : 'http://www.gnu.org/licenses/gpl-3.0-standalone.html'
                },
                'releases' : {
                    'title' : 'Releases',
                    'redirect' : 'https://github.com/AtesComp/rdf-transform/releases'
                },
                'download-latest' : { // RDF Transform Version Control
                    'title' : 'Download Latest',
                    'redirect' : 'https://github.com/AtesComp/rdf-transform/releases/download/v2.3.0/rdf-transform-2.3.0.zip'
                },
                'issues' : {
                    'title' : 'Issue Tracker',
                    'redirect' : 'https://github.com/AtesComp/rdf-transform/issues'
                },
                'source' : {
                    'title' : 'Source Code',
                    'redirect' : 'https://github.com/AtesComp/rdf-transform'
                },
            };

            // ==========================================
            //
            //  SITE CODE
            //
            // ==========================================

            var strURI = window.location.href;
            if (strURI.substring(strURI.length - 1) === '#') {
                strURI = strURI.substring(0, strURI.length - 1);
            }
            var strHash = window.location.hash;
            var strAbsBase = strURI.substring(0, strURI.length - strHash.length);

            var strSection = null;
            var strHeadTitle = null;
            var strTarget = null;
            var strTitle = null;
            var strTitleContent = null;
            var listPage = null;
            var listPageLinks = null;
            var strSidebar = null;
            var strContent = null;
            var strText = null;
            var strTextHtml = null;
            var strHtml = null;

            var strPage = '';
            if ( strHash.length > 0 ) {
                strPage = strHash.substr(1);
            }

            if ( ! (strPage in listPages) ) {
                strSection = 'none';
                strHeadTitle = '404 Not Found';
                strTitle = strHeadTitle;
                strContent = '404';
            }
            else if ( 'redirect' in listPages[strPage] ) {
                strSection = 'none';
                listPage = listPages[strPage];
                strTarget = listPage['redirect'];
                strHeadTitle = 'Redirect';
                strTextHtml =
                    '<p>The requested content is found at: <a href="' +
                    strTarget + '">' + strTarget + '</a></p>';
                    if ( 'title' in listPage) {
                        strTitle = listPage.title;
                    }
            }
            else {
                strSection = strPage;
                listPage = listPages[strPage];
                listPageLinks = listSectionLinks[strSection];
                if ( 'head_title' in listPage) {
                    strHeadTitle = listPage.head_title;
                }
                if ( 'title' in listPage) {
                    strTitle = listPage.title;
                }
                if ( 'title_content' in listPage) {
                    strTitleContent = listPage.title_content;
                }
                if ( 'sidebar' in listPage) {
                    strSidebar = listPage.sidebar;
                }
                if ( 'content' in listPage) {
                    strContent = listPage.content;
                }
                if ( 'text' in listPage) {
                    strText = listPage.text;
                }
            }

            // ==========================================
            //
            //  SITE TEMPLATE
            //
            // ==========================================

            const elemHeadTitle = document.getElementById("head_title");
            if (strHeadTitle != null) {
                elemHeadTitle.innerHTML = strHeadTitle + ' | RDF Transform';
            }

            document.getElementById("base_iri").setAttribute("href", strAbsBase);

            var strHeaderTitle = 'RDF Transform for OpenRefine';
            document.getElementById("header-title").innerHTML =
                '<img src="images/sw-cube.png" id="logo-img" />' +
                '<span id="logo-span">' + strHeaderTitle + '</span>';

            var strNav = '';
            for (const [strKey, strValue] of Object.entries(listMainLinks)) {
                if (strSection === strValue) {
                    strNav += '<li class="active"><span>' + strKey + '</span></li>';
                }
                else {
                    strNav += '<li' + (strValue === 'download' ? ' class="' + strValue + '"' : '') + '>' +
                                '<a href="#' + strValue + '">' + strKey + '</a>' +
                              '</li>';
                }
            }
            document.getElementById("main-nav").innerHTML = strNav;

            const elemTitle = document.getElementById("title");
            if (strTitle != null) {
                elemTitle.innerHTML = "<h1>" + strTitle + "</h1>";
            }
            else if (strTitleContent != null) {
                load_content(strTitleContent, elemTitle, strAbsBase);
            }
            else {
                elemTitle.innerHTML = '<h1>No title</h1>';
            }

            strHtml = '';
            var bLoadSidebar = false;
            var bLoadContent = false;
            var bLoadText = false;
            if (listPageLinks != null) {
                strHtml = '<ul id="section-nav">';

                for (const [strKey, strValue] of Object.entries(listPageLinks)) {
                    strHtml += '<li>';
                    if (strValue === strPage) {
                        strHtml += strKey;
                    }
                    else {
                        strHtml += '<a href="#' + strValue + '">' + strKey + '</a>';
                    }
                    strHtml += '</li>'
                }
                strHtml += '</ul>';
            }
            if (strSidebar != null) {
                strHtml += '<div id="sidebar"></div>';
                bLoadSidebar = true;
            }
            if (strContent != null) {
                strHtml += '<span id="text-content"></span>';
                bLoadContent = true;
            }
            else if (strText != null) {
                strHtml += '<div id="main"';
                if (listPageLinks != null) {
                    strHtml += ' class="centercol"';
                }
                strHtml += '></div>';
                bLoadText = true;
            }
            else if (strTextHtml != null) {
                strHtml = strTextHtml;
            }
            else {
                strHtml = '<p>No content or text configured for this page.</p>';
            }
            document.getElementById("content").innerHTML = strHtml;
            if (bLoadSidebar) {
                const elemSidebar = document.getElementById("sidebar");
                load_content(strSidebar, elemSidebar, strAbsBase);
            }
            if (bLoadContent) {
                const elemContent = document.getElementById("text-content");
                load_content(strContent, elemContent, strAbsBase);
            }
            if (bLoadText) {
                const elemMain = document.getElementById("main");
                load_content(strText, elemMain, strAbsBase);
            }

            getLinks( document.getElementsByTagName('a') );
        };

        window.addEventListener( "load", theLoader );
    </script>
  </body>
</html>
