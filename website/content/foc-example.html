<!--
 *  Example HTML
 *
 *  The RDF Transform Example HTML fragment.
 *
 *  Copyright 2025 Keven L. Ates
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
-->
<span>
  This is a simple example showing how RDF can be extracted from a <a href="example/foc.csv.html">CSV file</a>
  (from <a href="http://flavorsofcacao.com/chocolate_database.html">Flavors of Cacao: Chocolate Database</a>
  using <a href="example/foc.py.html">this little piece</a> of Python magic to extract the CSV).
</span>

<ul class="steps">
  <li class="step step1">
    Create a OpenRefine project based on the
    <a href="http://flavorsofcacao.com/chocolate_database.html">Flavors of Cacao: Chocolate Database</a>
    maintained by the <a href="http://flavorsofcacao.com/index.html">Flavors of Cacao</a> website.
    After renaming the columns, the first few lines of the <a href="example/foc.csv.html">CSV file</a>
    is shown in the figure below.
    <p>
      <img src="images/example/example_data.png" border="1" />
    </p>
    <p>
      The intended RDF we want to export should look something like the following (for the first line):
      <pre>
<code>
@prefix ingred: &lt;foc:choc:Ingredient#&gt; .
@prefix owl: &lt;http://www.w3.org/2002/07/owl#&gt; .
@prefix wiki: &lt;https://en.wikipedia.org/wiki/&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .
@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
@prefix ref: &lt;foc:choc:Reference#&gt; .
@prefix choc: &lt;foc:choc#&gt; .
@prefix foaf: &lt;http://xmlns.com/foaf/0.1/&gt; .
@prefix info: &lt;foc:choc:Info#&gt; .
@prefix vcard: &lt;http://www.w3.org/2006/vcard/ns#&gt; .
@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .

&lt;foc:choc&gt; {
    info:0  vcard:organization-name  "5150"@en ;
            choc:ingredients         _:b4942 ;
            vcard:country-name       "U.S.A."@en ;
            choc:characteristics     _:b4719 ;
            choc:beanOrigin          "Madagascar"@en ;
            choc:beanSpecifics       "Bejofo Estate, batch 1"@en ;
            choc:rating              "3.75"^^xsd:double ;
            choc:reference           ref:2454 ;
            choc:reviewDate          "2019-01-01"^^xsd:date ;
            choc:percent             "76"^^xsd:double .

    choc:5150  rdf:type  vcard:Organization .

    ref:2454  rdf:type  choc:Reference .

    _:b4942  rdf:li   ingred:Cocoa_Butter ;
            rdf:li    ingred:Sugar ;
            rdf:li    ingred:Beans ;
            rdf:type  rdf:Bag .

    _:b4719  rdf:li   "full body" ;
            rdf:li    "blackberry" ;
            rdf:li    "cocoa" ;
            rdf:type  rdf:Bag .

    ingred:Beans  rdfs:seeAlso  wiki:Cocoa_bean ;
            rdfs:label    "Beans" ;
            rdf:type      choc:Ingredient .

    ingred:Cocoa_Butter
            rdfs:seeAlso  wiki:Cocoa_butter ;
            rdfs:label    "Cocoa Butter" ;
            rdf:type      choc:Ingredient .

    ingred:Sugar  rdfs:seeAlso  wiki:Sugar ;
            rdfs:label    "Sugar" ;
            rdf:type      choc:Ingredient .
</code>
      </pre>
    </p>
  </li>
  <li class="step step2">
    Using <em>Edit RDF Transform...</em> command available under the <em>RDF Transform</em>
    extension menu, design the following transform:
    <p><img src="images/example/rdf-transform.png" alt="RDF Transform Dialog Example" border="1" /></p>
    <ol type="1">
      <li>Base IRI
        <div>
          Set the Base IRI at the top of the dialog to "http://cocoa/info/" or any other IRI that
          suits your, uh, taste. The Base IRI serves as the default graph / context (i.e., quad value)
          for a quad-based export file (such as TriG and N-Quads).
        </div>
      </li>
      <li>Namespaces
        <p>
          <img src="images/example/rdf_namespaces.png" alt="RDF Transform Manage Namespaces Example" border="1" style="float:left; margin-right:10px;" />
          <img src="images/example/rdf_add_prefix.png" alt="RDF Transform Add Prefix Example" border="1" />
        </p>
        <div>
          Namespaces can be managed by the <em>[+ Add]</em> and <em>[* Manage]</em> buttons on the
          <em>Available Namespaces:</em> line.  Add the following prefixed namespaces:<br />
          <ol>
            <li>Prefix "choc" with namespace "foc:choc"</li>
            <li>Prefix "ref" with namespace "foc:choc:Reference#"</li>
            <li>Prefix "info" with namespace "foc:choc:Info#"</li>
            <li>Prefix "ingred" with namespace "foc:choc:Ingredient#"</li>
            <li>Prefix "wiki" with namespace "https://en.wikipedia.org/wiki/"</li>
          </ol>
          You can remove any unused namespaces with the <em>[* Manage]</em> button.
        </div>
      </li>
      <li>Transform
        <div>
          <p>
            In the <em>Transform</em> tab window, create the transform by modifying exsting nodes and
            properties and adding new new nodes, types, and properties by using <em>Add type...</em>,
            <em>Add property...</em>, and <em>Add object...</em> commands as needed. Use the
            <em>[Add Root Node]</em> button to manage additional root nodes as needed. Root nodes may
            be IRIs copied from inner objects to manage substructures for specific purposes.  Constant
            IRIs and blank nodes are applied project-wide (not restricted to a row or record).
          </p>
          <p>
            Alternatively, You may start from scratch by deleting all the root nodes with the (X)
            buttons. 
          </p>
          <p>
            <b>NOTE</b>: When importing a template, the template is added as new root node(s) to the
            existing template. Ensure any extranious root nodes are removed.
          </p>
        </div>
        <ol type="1">
          <li>Create
            <div>
              <p>
                Create any needed node or property to expand your results.
              </p>
              <p>
                For example, create a new type <em>Reference</em> using the "choc" prefixed namespace on
                the <em>REF</em> object node.
              </p>
              <p>
                This should create a type for the node. When using prefixed namespaces, the type has a
                full IRI and Condensed IRI Expression (CIRIE). They are displayed when selecting the
                type after creation. For example:
                <img src="images/example/rdf_CIRIE.png" alt="RDF Transform Full IRI and CIRIE Example" border="1" />
              </p>
            </div>
          </li>
          <li>Edit
            <div>
              <p>
                Edit any existing node or property as needed to adjust or refine your results.
              </p>
              <p>
                For example, edit the property <em>Review Date</em> changing it to use the "choc" prefixed namespace and
                the property name <em>reviewDate</em> (i.e., choc:reviewDate). You should use the <em>Add it</em> button
                to add the term to the Lucene lookup database, so that any additional usage can help selection.
                For example:
                <img src="images/example/rdf_property.png" alt="RDF Transform Property Selection Example" border="1" />
              </p>
            </div>
          </li>
          <li>Delete
            <div>
              <p>
                Delete (X) any node or property as needed. Deleteing an entity also deletes any
                related subentities.
              </p>
            </div>
          </li>
        </ol>
        <div>
          The figure below shows an example of a RDF Node dialog (the <em>Bean Type IRI</em> resource):
          <div class="image">
            <img src="images/example/rdf_node.png" alt="RDF Node Dialog Example" border="1" />
          </div>
          Notice the custom expression used to define the IRI. The <em>Edit & Preview</em> command displays
          the "Preview Expression: IRI" dialog allowing edits and showing sample values from the first 10
          rows:
          <p><img src="images/example/edit_grel.png" alt="Preview Expression Dialog Example" border="1" /></p>
        </div>
      <li>
        <div>
          After managing the RDF Transform template, use the "Preview" tab to periodically check your results for correctness.
          <img src="images/example/rdf_preview_1.png" alt="RDF Template Preview Data Example 1" border="1" />
          <img src="images/example/rdf_preview_2.png" alt="RDF Template Preview Data Example 2" border="1" />
        </div>
      </li>
      <li>
        <div>
          As an additional exercise, use GREL to breakdown the "Ingredients" string
          into actual ingredient resource IRIs. There are 7 total ingredients available in
          all ingredients strings. Change your "ingredients" as follows:<br />
          <b>Note</b>: For reference, an ingredents string looks like "n- i1,i2,...,in" where "n" is the
          number of ingredents and "i1" to "in" is a 1-2 character string representing the ingredient.<br />
          I.e, B = Beans, S = Sugar, S* = Non-sugar Sweetener, C = Cocoa Butter, V = Vanilla, L = Lecithin,
          Sa = Salt (see the
          <a href="https://flavorsofcacao.com/chocolate_database.html">FoC Database page</a>
          for related info).
          <ol type="1">
            <li>
              Use your "ingredients" property to point to a Blank Node with type "rdf:Bag"
            </li>
            <li>
              From the Blank Node, use property "rdf:li" to point to 7 new nodes created by breaking down the
              string into components to use some name (from the above ingredient reference) to create an
              "ingred:SomeName" IRI.<br />
              <b>Hint</b>: You will need to create an array of strings from the data and test its given size
              againts the index (> 0, > 1, ..., > 6) for each of the 7 nodes you will create. Then compare the
              indexed string against its known values to transform it to a full name string value. Use that
              value to create the IRI. Use null for any failed cases to suppress the value.
              GREL with(), smartSplit(), and toIRIString() are your friends.
              <details>
                <summary>Show the code</summary>
                <p>
                  This solution uses toIRIString() on the final string to normalize to an IRI.
                  Change the index values for each entry. For the first (0) index,
                </p>
                <pre>
if(
  isNonBlank(value),
  with(
    smartSplit( toString(value), '-'),
    aList,
    if(
      toNumber( aList[0] ) > <b>0</b>, <b>&lt;-- size &gt; index</b>
      toIRIString(
        with(
          trim( smartSplit( aList[1] )[<b>0</b>] ), <b>&lt;-- index</b>
          cIng,
          if( cIng=='B', 'Beans',
           if( cIng=='S', 'Sugar',
             if( cIng=='S*', 'Non-sugar Sweetener',
               if( cIng=='C', 'Cocoa Butter',
                 if( cIng=='V', 'Vanilla',
                   if( cIng=='L', 'Lecithin',
                     if( cIng=='Sa', 'Salt',
                       null ) ) ) ) ) ) )
        )
      ),
      null
    )
  ),
  null
)
                </pre>
              </details>
            </li>
            <li>
              Type these new nodes as "choc:Ingredient"
            </li>
            <li>
              Create a label (rdfs:label) for each ingredient using a similar GREL expression for the node IRI.
              <details>
                <summary>Show the code</summary>
                <p>
                  This solution has removed the toIRIString() from the previous solution so that the same string
                  can be used for IRI and label.
                  Change the index values for each entry. For the first (0) index,
                </p>
                <pre>
if(
  isNonBlank(value),
  with(
    smartSplit( toString(value), '-'),
    aList,
    if(
      toNumber( aList[0] ) > <b>0</b>, <b>&lt;-- size &gt; index</b>
      with(
        trim( smartSplit( aList[1] )[<b>0</b>] ), <b>&lt;-- index</b>
        cIng,
        if( cIng=='B', 'Beans',
          if( cIng=='S', 'Sugar',
            if( cIng=='S*', 'Non-sugar Sweetener',
              if( cIng=='C', 'Cocoa Butter',
                if( cIng=='V', 'Vanilla',
                  if( cIng=='L', 'Lecithin',
                    if( cIng=='Sa', 'Salt',
                      null ) ) ) ) ) ) )
      ),
      null
    )
  ),
  null
)
                </pre>
              </details>
            </li>
            <li>
              Create a reference (rdfs:seeAlso) to the Wikipedia URLs for each ingredient (see Wikidata,
              DBpedia, or any other favored location as well) using nearly a similar GREL expression for
              the node IRI.  Example result: "wiki:Cocoa_bean" for "B" where "wiki" is the prefix for
              namespace "https://en.wikipedia.org/wiki/"
              <details>
                <summary>Show the code</summary>
                <p>
                  This solution uses the trailing URL string from the "https://en.wikipedia.org/wiki/"
                  reference such as "https://en.wikipedia.org/wiki/Cocoa_bean".
                  Change the index values for each entry. For the first (0) index,
                </p>
                <pre>
if(
  isNonBlank(value),
  with(
    smartSplit( toString(value), '-'),
    aList,
    if(
      toNumber( aList[0] ) > <b>0</b>, <b>&lt;-- size &gt; index</b>
      with(
        trim( smartSplit( aList[1] )[<b>0</b>] ), <b>&lt;-- index</b>
        cIng,
        if( cIng=='B', 'Cocoa_bean',
          if( cIng=='S', 'Sugar',
            if( cIng=='S*', 'Sugar_substitute',
              if( cIng=='C', 'Cocoa_butter',
                if( cIng=='V', 'Vanilla',
                  if( cIng=='L', 'Lecithin',
                    if( cIng=='Sa', 'Salt',
                      null ) ) ) ) ) ) )
      ),
      null
    )
  ),
  null
)
                </pre>
              </details>
            </li>
          </ol>
        </div>
      </li>
      <li>
        <div>
          As an additional exercise, use GREL to breakdown the "Most Memorable
          Characteristics" string into individual characteristics strings. There are
          at most 5 characteristics mostly separated by a comma. There are a few that
          alternatively use the string " and " to separate 2 characteristics.<br />
          <b>Hint</b>: GREL with() and smartSplit() are your friends.
          <details>
            <summary>Show the code</summary>
            <p>
              This solution uses the trailing URL string from the "https://en.wikipedia.org/wiki/"
              reference such as "https://en.wikipedia.org/wiki/Cocoa_bean".
              Change the index values for each entry. For the first (0) index,
            </p>
            <pre>
with(
  if(
    isNonBlank(value),
    smartSplit( toString(value), " and " ),
    null
  ),
  aAnd,
  if(
    isNotNull(aAnd),
    strip(
      with(
        smartSplit(
          if( length(aAnd) == 2, aAnd[0] + ", " + aAnd[1], aAnd[0] ),
          ','
        ),
        aList,
        if( length(aList) > <b>0</b>, aList[<b>0</b>], '') <b>&lt;-- size &gt; index, index</b>
      )
    ),
    astr
  )
)
            </pre>
          </details>
        </div>
      </li>
    </ol>
    <br />
    <div class="note">
      SPOILER ALERT! For the above additional exercises, the provided
      <a href="example/foc.json.html">Flavors of Cacao JSON Template</a> contains the
      structure (pretty printed for your reading enjoyment) and the GREL expressions
      used to break down these strings.
    </div>
  </li>
  <li class="step step3">
    Save the transform by clicking the <em>Save</em> button to immediately save or the <em>OK</em>
    button to exit. Notice that a "Save RDF Transform" operation is added to the Undo / Redo history
    panel of OpenRefine. History items can be undone, redone, exported, and re-applied.
    <p><img src="images/example/history.png" alt="History (Undo/Redo) Tab Example" border="1" /></p>
  </li>
  <li class="step step4">
    You can export RDF data in many different RDF formats from the <em>Export</em> menu:
    <p><img src="images/example/rdf_export.png" alt="Export RDF Menu Item Example" border="1" /></p>
    <p><b>NOTE</b>: Due to the data processing model, the Stream exports do not perform any different
       than Pretty exports. The previous process produced too many duplicative triples. Therefore, the
       Stream process now loads the entire data model into a memory DatasetGraph just like the Pretty
       process. Stream results are a bit more compact than the Pretty counterparts.</p>
    <p><b>WARNING</b>: Since the entire model in loaded into memory before output, memory limitation may
       affect your process.</p>
    <p>Stream output types are exports that work on discreet blocks or lines of output. They are
       readable but may duplicate triple information during output. Their best feature is that they
       scale well for the output processing of large datasets.</p>
    <p>Pretty output types are exports that optimize an entire graph to minimize duplicative triples.
       They look good, but they don't scale well.  As such, use these with caution for large datasets.</p>
    <ol>
      <li>RDF as Turtle (Stream) - A Turtle formatted, stream optimized export</li>
      <li>RDF as TRiG (Stream) - A Turtle like, graph oriented, stream optimized export</li>
      <li>RDF as N-Triples (Stream) - A basic "Line per Triple" stream optimized export</li>
      <li>RDF as N-Quads (Stream) - A basic "Line per Quad" stream optimized export (identical to N-Triple)</li>
      <li>RDF as TriX (Stream) - A basic "Triples in XML" stream optimized export</li>
      <li>RDF as RDFNull (Test) - A NULL test, yet stream optimized, export (produces a zero byte file)</li>
      <li>RDF as ProtoBuf (Stream) - A binary condensed, stream optimized export</li>
      <li>RDF as RDFThrift (Stream) - A binary condensed, stream optimized export</li>
    </ol>
  </li>
</ul>